!function e(t,i,s){function o(n,a){if(!i[n]){if(!t[n]){var l="function"==typeof require&&require;if(!a&&l)return l(n,!0);if(r)return r(n,!0);var c=new Error("Cannot find module '"+n+"'");throw c.code="MODULE_NOT_FOUND",c}var p=i[n]={exports:{}};t[n][0].call(p.exports,function(e){var i=t[n][1][e];return o(i||e)},p,p.exports,e,t,i,s)}return i[n].exports}for(var r="function"==typeof require&&require,n=0;n<s.length;n++)o(s[n]);return o}({1:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default={frames:{"cross explode 01.png":{frame:{x:1,y:1682,w:44,h:46},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:44,h:46},sourceSize:{w:44,h:46}},"cross explode 02.png":{frame:{x:963,y:1619,w:148,h:89},rotated:!1,trimmed:!0,spriteSourceSize:{x:0,y:30,w:148,h:89},sourceSize:{w:148,h:148}},"cross explode 03.png":{frame:{x:682,y:1619,w:279,h:146},rotated:!1,trimmed:!0,spriteSourceSize:{x:7,y:71,w:279,h:146},sourceSize:{w:290,h:290}},"cross explode 04.png":{frame:{x:1695,y:1332,w:325,h:313},rotated:!1,trimmed:!0,spriteSourceSize:{x:19,y:12,w:325,h:313},sourceSize:{w:346,h:346}},"cross explode 05.png":{frame:{x:1774,y:866,w:185,h:160},rotated:!1,trimmed:!0,spriteSourceSize:{x:4,y:16,w:185,h:160},sourceSize:{w:202,h:202}},"cross explode 06.png":{frame:{x:1299,y:1332,w:394,h:394},rotated:!1,trimmed:!0,spriteSourceSize:{x:16,y:2,w:394,h:394},sourceSize:{w:410,h:410}},"cross explode 07.png":{frame:{x:682,y:1001,w:615,h:616},rotated:!1,trimmed:!0,spriteSourceSize:{x:0,y:12,w:615,h:616},sourceSize:{w:642,h:642}},"cross explode 08.png":{frame:{x:1,y:1,w:998,h:998},rotated:!1,trimmed:!0,spriteSourceSize:{x:1,y:10,w:998,h:998},sourceSize:{w:1012,h:1012}},"cross explode 09.png":{frame:{x:1001,y:1,w:863,h:863},rotated:!1,trimmed:!0,spriteSourceSize:{x:16,y:121,w:863,h:863},sourceSize:{w:1012,h:1012}},"cross explode 10.png":{frame:{x:1299,y:866,w:473,h:464},rotated:!1,trimmed:!0,spriteSourceSize:{x:13,y:0,w:473,h:464},sourceSize:{w:486,h:486}},"cross explode 11.png":{frame:{x:1,y:1001,w:679,h:679},rotated:!1,trimmed:!0,spriteSourceSize:{x:7,y:18,w:679,h:679},sourceSize:{w:714,h:714}}},meta:{app:"http://www.codeandweb.com/texturepacker",version:"1.0",image:"cross-blast.png",format:"RGBA8888",size:{w:2021,h:1766},scale:"1",smartupdate:"$TexturePacker:SmartUpdate:aaec39ea67c62d4f7f6d14b7f4afa121:b02937fda42494cdb0c75e8acf3f5e24:bb134807cd8cb10c2611111c3dcb7bbf$"}}},{}],2:[function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}var o=e("./states/boot"),r=s(o),n=e("./states/endcard"),a=s(n),l=e("./states/preloader"),c=s(l),p=new Phaser.Game(window.innerWidth*window.devicePixelRatio,window.innerHeight*window.devicePixelRatio,Phaser.CANVAS,"game",null,!0);p.state.add("boot",new r.default),p.state.add("endcard",new a.default),p.state.add("preloader",new c.default),p.state.start("boot")},{"./states/boot":7,"./states/endcard":8,"./states/preloader":9}],3:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default={horizontal:{horizontal:!0,vertical:!1,slopeUp:!1,slopeDown:!1,blastRadius:0,colorMatch:!1,destroyDelay:0},vertical:{horizontal:!1,vertical:!0,slopeUp:!1,slopeDown:!1,blastRadius:0,colorMatch:!1,destroyDelay:0},horizontalAndVertical:{horizontal:!0,vertical:!0,slopeUp:!1,slopeDown:!1,blastRadius:0,colorMatch:!1,destroyDelay:0},horizontalAndVerticalBig:{horizontal:!0,vertical:!1,slopeUp:!1,slopeDown:!1,blastRadius:1,colorMatch:!1,destroyDelay:500,horizontalAndVerticalBig:!0},blast:{horizontal:!1,vertical:!1,slopeUp:!1,slopeDown:!1,blastRadius:1,colorMatch:!1,repeat:1,destroyDelay:0},biggerBlast:{horizontal:!1,vertical:!1,slopeUp:!1,slopeDown:!1,blastRadius:2,colorMatch:!1,destroyDelay:0},hugeBlast:{horizontal:!1,vertical:!1,slopeUp:!1,slopeDown:!1,blastRadius:3,colorMatch:!1,destroyDelay:0},colorMatch:{horizontal:!1,vertical:!1,slopeUp:!1,slopeDown:!1,blastRadius:0,colorMatch:!0,destroyDelay:1e3},destroyAll:{horizontal:!1,vertical:!1,slopeUp:!1,slopeDown:!1,blastRadius:0,colorMatch:!1,destroyAll:!0,destroyDelay:1450}}},{}],4:[function(e,t,i){"use strict";function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function o(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(i,"__esModule",{value:!0});var l=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),c=e("../prefabs/explosions"),p=o(c),h=e("../prefabs/tile"),u=o(h),d=e("../utils/custom-tile-events"),g=s(d),f=e("../utils/tile-util"),y=s(f),m=e("../utils/util"),v=s(m),b=function(e){function t(e,i){r(this,t);var s=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return s.properties={width:s.getWidth(),fieldSize:PiecSettings.fieldSize,settings:i,fallDuration:PiecSettings.fallDuration},s.properties.tileSize=s.properties.width/PiecSettings.fieldSize,s.alpha=0,e.add.existing(s),s.createGrid(),s.resize(),PiecSettings.pickInitialTile.add(s.pickInitialTile,s),window.globalCount=0,s}return a(t,e),l(t,[{key:"resize",value:function(){var e=this.getWidth()/this.properties.width,t=document.getElementById("game-mask").getBoundingClientRect(),i={x:t.left*window.devicePixelRatio,y:t.top*window.devicePixelRatio};this.scale.x=e,this.scale.y=e,this.x=i.x,this.y=i.y,this.applyMask()}},{key:"applyMask",value:function(){var e=this.game.add.graphics(this.x,this.y);e.beginFill(16777215);for(var t,i=this.width/PiecSettings.fieldSize,s=0;s<PiecSettings.fieldSize;s++)for(var o=0;o<PiecSettings.fieldSize;o++)t=!1,PiecSettings.gridShape.forEach(function(e){e.x===s&&e.y===o&&(t=!0)}),!1===t&&e.drawRect(s*i,o*i,i,i);this.mask=e}},{key:"getWidth",value:function(e){return document.getElementById("game-mask").offsetWidth*window.devicePixelRatio}},{key:"createGrid",value:function(){this.createEmptyGrid(),this.applyStartingTiles(),this.createTiles()}},{key:"createEmptyGrid",value:function(){this.game.global.tiles=[];for(var e=0;e<this.properties.fieldSize;e++){this.game.global.tiles[e]=[];for(var t=0;t<this.properties.fieldSize;t++)this.game.global.tiles[e][t]=null}}},{key:"applyStartingTiles",value:function(){var e,t=PiecSettings.startingTiles||[];t.forEach(function(t){e=new u.default(this.game,t.x,t.y,t.tileType,this.properties.tileSize),e.properties.isStartingTile=!1,this.game.global.tiles[t.y][t.x]=e,this.add(e)},this)}},{key:"createTiles",value:function(){for(var e,t,i,s=0;s<this.properties.fieldSize;s++)for(var o=0;o<this.properties.fieldSize;o++){for(e=!0;!0===e;)i=this.genTileType(o,s),t=i.tileType,e=i.shouldReGen;null===this.game.global.tiles[s][o]&&(this.game.global.tiles[s][o]=new u.default(this.game,o,s,t,this.properties.tileSize),this.add(this.game.global.tiles[s][o]))}}},{key:"genTileType",value:function(e,t){var i=y.getItemAt(this.game.global.tiles,e,t-1),s=y.getItemAt(this.game.global.tiles,e,t-2),o=y.getItemAt(this.game.global.tiles,e-1,t),r=y.getItemAt(this.game.global.tiles,e-2,t),n=y.getItemAt(this.game.global.tiles,e,t+1),a=y.getItemAt(this.game.global.tiles,e,t+2),l=y.getItemAt(this.game.global.tiles,e+1,t),c=y.getItemAt(this.game.global.tiles,e+2,t),p=Math.floor(Math.random()*PiecSettings.tileTypes),h=!1;return null!==i&&null!==s&&i.properties.color===s.properties.color&&i.properties.color===PiecSettings.tiles[p].color&&(h=!0),null!==o&&null!==r&&o.properties.color===r.properties.color&&o.properties.color===PiecSettings.tiles[p].color&&(h=!0),null!==n&&null!==a&&n.properties.color===a.properties.color&&n.properties.color===PiecSettings.tiles[p].color&&(h=!0),null!==l&&null!==c&&l.properties.color===c.properties.color&&l.properties.color===PiecSettings.tiles[p].color&&(h=!0),!1===PiecSettings.isSwipe&&(h=!1),{shouldReGen:h,tileType:p}}},{key:"swipeTile",value:function(e,t){if(!0!==this.game.global.locked){this.resetMoveStats();var i=y.getAdjacent(this.game.global.tiles,e,t),s={x:e.properties.x,y:e.properties.y,xCoord:e.x,yCoord:e.y};if(null!==i){for(var o=0;o<PiecSettings.gridShape.length;o++)if(PiecSettings.gridShape[o].x===i.properties.x&&PiecSettings.gridShape[o].y===i.properties.y)return;piec.lockGame(),e.properties.x=i.properties.x,e.properties.y=i.properties.y,i.properties.x=s.x,i.properties.y=s.y,this.game.global.tiles[e.properties.y][e.properties.x]=e,this.game.global.tiles[i.properties.y][i.properties.x]=i;var r=y.getLineMatches(this.game.global.tiles,e,PiecSettings.minMatchSize),n=y.getLineMatches(this.game.global.tiles,i,PiecSettings.minMatchSize),a=r.tiles.length>0||n.tiles.length>0,l=(this.game.add.tween(e).to({x:i.x,y:i.y},150,Phaser.Easing.Linear.None,!0),this.game.add.tween(i).to({x:e.x,y:e.y},150,Phaser.Easing.Linear.None,!0)),c=[];l.onComplete.add(function(){if(this.addComboBlastTiles(c,e,i),!1===a&&0===c.length){this.game.add.tween(e).to({x:i.x,y:i.y},150,Phaser.Easing.Linear.None,!0),this.game.add.tween(i).to({x:e.x,y:e.y},150,Phaser.Easing.Linear.None,!0);i.properties.x=e.properties.x,i.properties.y=e.properties.y,e.properties.x=s.x,e.properties.y=s.y,this.game.global.tiles[e.properties.y][e.properties.x]=e,this.game.global.tiles[i.properties.y][i.properties.x]=i,piec.unlockGame()}else{this.game.onMoveStart(this.game);var t=this.getCombineExplosion(e,i);g.onComboStart(this.parent.game,e,i,t),this.game.time.events.add(null===t?0:t.destroyDelay,function(){null!==t&&(e.properties.explode=1e3,i.properties.explode=1e3);var s=[r,n];s=s.concat(c),this.addBlastTiles(s),this.destroyMatchingTiles(s)},this)}},this)}}}},{key:"getCombineExplosion",value:function(e,t){for(var i,s,o=PiecSettings.tiles[e.properties.tileType],r=PiecSettings.tiles[t.properties.tileType],n=0;n<PiecSettings.uniquePieceCombos.length;n++)if(i=void 0===PiecSettings.uniquePieceCombos[n].type1||PiecSettings.uniquePieceCombos[n].type1===o.explode,s=void 0===PiecSettings.uniquePieceCombos[n].type2||PiecSettings.uniquePieceCombos[n].type2===r.explode,i&&s)return p.default[PiecSettings.uniquePieceCombos[n].resultsIn];return null}},{key:"addComboBlastTiles",value:function(e,t,i){var s,o,r=PiecSettings.tiles[t.properties.tileType],n=PiecSettings.tiles[i.properties.tileType];if(r.explode&&n.explode&&PiecSettings.uniquePieceCombos.forEach(function(i){if((i.type1===r.explode&&i.type2===n.explode||i.type1===n.explode&&i.type2===r.explode)&&(o=i,s=p.default[i.resultsIn],e.push({color:"any",hMatches:0,original:t,tiles:y.getMatches(this.game.global.tiles,t,s),vMatches:0}),!0===s.horizontalAndVerticalBig)){var a=v.clone(s);a.vertical=!0,a.horizontal=!1,this.batchExplode=y.getMatches(this.game.global.tiles,t,a)}},this),!("colorMatch"===r.explode&&"colorMatch"===n.explode||"colorMatch"!==r.explode&&"colorMatch"!==n.explode))if(r.explode&&n.explode){var a="colorMatch"===r.explode?n:r,l=[];(o.generates||[]).forEach(function(e){l.push(y.getTileTypes(a.color,e)[0])},this);var c=y.getAllTilesByColor(this.game.global.tiles,a.color);c.forEach(function(e){a=v.sample(l),e.frame=PiecSettings.tiles.indexOf(a),e.properties.tileType=PiecSettings.tiles.indexOf(a),e.properties.color="nevermatch",e.combine(this.game,this)},this);var h="colorMatch"===r.explode?t:i;h.destroy(),this.game.global.tiles[h.properties.y][h.properties.x]=null,this.batchExplode=c}else{var u;"any"!==t.properties.color&&(u=t.properties.color),"any"!==i.properties.color&&(u=i.properties.color),s=p.default.colorMatch,e.push({color:"any",hMatches:PiecSettings.minMatchSize,original:"colorMatch"===r.explode?t:i,tiles:y.getMatches(this.game.global.tiles,"colorMatch"===r.explode?t:i,s,u),vMatches:PiecSettings.minMatchSize})}}},{key:"addBlastTiles",value:function(e,t){var i=[];e.forEach(function(s){(!0===t||s.hMatches>=PiecSettings.minMatchSize||s.vMatches>=PiecSettings.minMatchSize)&&s.tiles.forEach(function(t){i=y.getAllTilesToDestroy(this.game.global.tiles,t),null!==t&&i.length>0&&e.push({color:t.properties.color,hMatches:0,original:t,tiles:i,vMatches:0})},this)},this)}},{key:"combosContainsRule",value:function(e,t){for(var i=0;i<e.length;i++)if(e[i].rule===t)return!0;return!1}},{key:"destroyMatchingTiles",value:function(e,t){if(0===e.length)return void this.onMoveComplete();var i,s,o=[],r=[];e.forEach(function(e){i=this.getCombo(e),null!==i?this.combosContainsRule(r,i.rule)||(void 0!==i.frame?s=i.frame:void 0!==i.properties.tileType&&(s=i.properties.tileType),r.push({frame:s,rule:i.rule,tile:e.original,tiles:e.tiles})):e.tiles.forEach(function(e){o.push(e)},this)},this),r=v.uniq(r),o=v.uniq(o),this.updateMoveStats(o);var n,a,l,c,h,u=!1;r.forEach(function(e){u=!0,void 0!==e.frame?n=e.frame:void 0!==e.properties.tileType&&(n=e.properties.tileType),this.game.global.tiles[e.tile.y][e.tile.x].properties.tileType=n,a=this.game.global.tiles[e.tile.y][e.tile.x],e.tiles.forEach(function(t){h=PiecSettings.tiles[t.properties.tileType],c=h.explode?p.default[h.explode]:{},l=void 0!==c.repeat,t.properties.x===e.tile.x&&t.properties.y===e.tile.y||null===this.game.global.tiles[t.properties.y][t.properties.x]||!1!==l||(this.game.global.tiles[t.properties.y][t.properties.x]=null,t.moveTo(this.game,a.x,a.y,PiecSettings.combineDelay,function(e){e.destroy()}))},this),this.game.time.events.add(PiecSettings.combineDelay,function(){a.combine(this.game,this),a.swapImg(n)},this)},this);for(var d,g,f=0;f<o.length;f++)o[f]&&null!==o[f].properties.x&&null!==o[f].properties.y&&(d=!1,r.forEach(function(e){o[f].properties.x===e.tile.x&&o[f].properties.y===e.tile.y&&(d=!0),e.tiles.forEach(function(e){e.properties.x!==o[f].properties.x||e.properties.y!==o[f].properties.y||PiecSettings.tiles[e.properties.tileType].explode||(d=!0)},this)},this),!1===d&&(l=!1,(g=this.game.global.tiles[o[f].properties.y][o[f].properties.x])&&(g.properties.explode=g.properties.explode||0,g.properties.explode++,h=PiecSettings.tiles[g.properties.tileType],h.explode&&(c=p.default[h.explode],l=void 0!==c.repeat&&c.repeat>=g.properties.explode),!1===l?!0!==this.game.global.tiles[o[f].properties.y][o[f].properties.x].properties.indestructable&&(this.game.global.tiles[o[f].properties.y][o[f].properties.x]=null,o[f].explode(this.game,this)):(g.properties.isReadyToExplode=!0,g.playAnimation(this.game,this,g.getAnimation(h.animation)),g.jiggle()))));!1!==t&&this.game.time.events.add(u?PiecSettings.combineDelay:0,function(){this.fall(PiecSettings.fallUpwards),this.fallFrom(PiecSettings.fallUpwards)},this)}},{key:"resetMoveStats",value:function(){this.game.global.moveStats={attack:0,defend:0}}},{key:"updateMoveStats",value:function(e){var t;e.forEach(function(e){e&&(t=PiecSettings.tiles[e.properties.tileType],this.game.global.moveStats[t.attribute]++,console.log("tileinfo"+t.attribute))},this)}},{key:"removeDupes",value:function(e){this.forEach(function(t){t!==e&&t.x===e.x&&t.y===e.y&&(console.log("remove duplicate"),t.destroy())},this)}},{key:"onMoveComplete",value:function(){if(this.game.global.fallingTiles<=0){if(this.getHoles()>0&&0===(this.game.global.freezeCols||[]).length)return this.fall(PiecSettings.fallUpwards),void this.fallFrom(PiecSettings.fallUpwards);var e,t=this.getRepeaters();if(t.length>0)return void this.game.time.events.add(300,function(){e=[],t.forEach(function(t){e.push({color:t.properties.color,hMatches:0,original:t,tiles:y.getAllTilesToDestroy(this.game.global.tiles,t),vMatches:0})},this),this.destroyMatchingTiles(e)},this);if(this.batchExplode=this.batchExplode||[],!0===this.game.global.isComplete&&(this.batchExplode=y.getAllUniqueGamePieces(this.game.global.tiles)),this.batchExplode.length>0&&(this.game.global.freezeCols||[]).length>0)return void this.game.time.events.add(200,function(){this.game.global.freezeCols=[],this.destroyAllBatchExplodeItem()},this);if(this.batchExplode.length>0)return void this.destroyRandomBatchExplodeItem();piec.unlockGame(),this.game.onMoveComplete(this.game),!0===this.game.global.isComplete&&this.game.onGameComplete.dispatch()}}},{key:"destroyRandomBatchExplodeItem",value:function(){console.log("destroyRandomBatchExplodeItem");var e=v.sample(this.batchExplode),t=[{color:e.properties.color,hMatches:0,original:e,tiles:[e],vMatches:0}];this.addBlastTiles(t,!0),this.destroyMatchingTiles(t)}},{key:"destroyAllBatchExplodeItem",value:function(){var e=v.sample(this.batchExplode),t=[{color:e.properties.color,hMatches:0,original:e,tiles:this.batchExplode,vMatches:0}];this.addBlastTiles(t,!0),this.destroyMatchingTiles(t)}},{key:"getRepeaters",value:function(){var e,t,i=[];for(e=0;e<this.game.global.tiles.length;e++)for(t=0;t<this.game.global.tiles[e].length;t++)null!==this.game.global.tiles[e][t]&&!0===this.game.global.tiles[e][t].properties.isReadyToExplode&&i.push(this.game.global.tiles[e][t]);return i}},{key:"getCombo",value:function(e){if(!PiecSettings.swipeCombineRules)return null;for(var t,i,s=0;s<PiecSettings.swipeCombineRules.length;s++)if(t=PiecSettings.swipeCombineRules[s],t.horizontal.indexOf(e.hMatches)>=0&&t.vertical.indexOf(e.vMatches)>=0){i=PiecSettings.swipeCombineRules[s].generates,i=i.replace("%color%",e.color);for(var o=0;o<PiecSettings.tiles.length;o++)if(PiecSettings.tiles[o].id===i)return{frame:o,rule:t}}return null}},{key:"matchAllTiles",value:function(){for(var e,t=[],i=0;i<this.game.global.tiles.length;i++)for(var s=0;s<this.game.global.tiles[i].length;s++)null!==this.game.global.tiles[i][s]&&(e=y.getLineMatches(this.game.global.tiles,this.game.global.tiles[i][s],PiecSettings.minMatchSize),e.tiles.length>0&&!1===this.containsMatch(t,this.game.global.tiles[i][s])&&t.push(e));this.addBlastTiles(t),this.destroyMatchingTiles(t)}},{key:"containsMatch",value:function(e,t){for(var i=0;i<e.length;i++)for(var s=0;s<e[i].length;s++)if(e[i][s].properties.x===t.properties.x&&e[i][s].properties.y===t.properties.y)return!0;return!1}},{key:"matchTiles",value:function(){for(var e=0;e<this.global.tiles.length;e++)for(var t=0;t<this.global.tiles[e].length;t++)({h:y.getAllAdjacentMatches(this.game.global.tiles,this.game.global.tiles[e][t],!0,!1,[]),v:y.getAllAdjacentMatches(this.game.global.tiles,this.game.global.tiles[e][t],!1,!0,[])})}},{key:"pickInitialTile",value:function(){}},{key:"pickTile",value:function(e,t){if(!0!==this.game.global.locked){piec.lockGame(),this.resetMoveStats();var i=y.getAllAdjacentMatches(this.game.global.tiles,e,!0,!0,[]),s=PiecSettings.tiles[e.properties.tileType];s.delay>0&&1===i.length&&(e.alpha=0,e.properties.surpressExplodeAnimation=!0,e.playAnimation(this.game,this,s.activateAnimation)),this.game.time.events.add(s.delay||0,function(){if(s.explode){var o,r,n={};i.forEach(function(i){o=PiecSettings.tiles[i.properties.tileType],r=o.id.replace("rocketv","rocket").replace("rocketh","rocket").replace(o.colorMatch+"-",""),n[r]||(n[r]=0),n[r]++,!1!==t&&this.game.add.tween(i).to({x:e.x,y:e.y},PiecSettings.combineDelay,Phaser.Easing.Linear.None,!0)},this),this.game.time.events.add(!1!==t?PiecSettings.combineDelay:0,function(){var s,o,r,a,l;!1!==t&&PiecSettings.tapUniquePieceCombos.forEach(function(e){o=!0;for(var t in e)e.hasOwnProperty(t)&&(t.indexOf("Min")>-1&&(r=t.replace("Min","").replace("%color%"),(a=n[r]||0)<e[t]&&(o=!1)),t.indexOf("Max")>-1&&(r=t.replace("Min",""),(a=n[r]||0)>e[t]&&(o=!1)));!0===o&&(i.forEach(function(e){e.properties.tileType=0,e.alpha=0},this),s=p.default[e.resultsIn],l=e)},this);var c=[];s?c.push({color:"any",hMatches:PiecSettings.minMatchSize,original:e,tiles:y.getMatches(this.game.global.tiles,e,s),vMatches:PiecSettings.minMatchSize}):c.push({color:"any",hMatches:PiecSettings.minMatchSize,original:e,tiles:i,vMatches:PiecSettings.minMatchSize});var h=0;l&&l.delay&&(h=l.delay,e.playAnimation(this.game,this,l.animation)),l&&"horizontalAndVertical"===l.resultsIn&&e.rocketFly(this.game,this,!0,!0),l&&"horizontalAndVerticalBig"===l.resultsIn&&e.rocketFly(this.game,this,!0,!0,2),this.game.time.events.add(h,function(){if(l&&void 0!==l.tranformBlastTilesTo){this.staggerExplosions=[];var e=l.tranformBlastTilesTo.constructor===Array?l.tranformBlastTilesTo:[l.tranformBlastTilesTo];c.forEach(function(t){t.tiles.forEach(function(t){t.swapImg(v.sample(e)),this.staggerExplosions.push(t)},this)},this),i.forEach(function(e){this.game.global.tiles[e.properties.y][e.properties.x]=null},this),this.fall(PiecSettings.fallUpwards),this.fallFrom(PiecSettings.fallUpwards),this.staggerExplode()}else{this.addBlastTiles(c),this.destroyMatchingTiles(c,!1);var t=0;c.forEach(function(e){e.tiles.forEach(function(e){e.properties.explodeSeq&&e.properties.explodeSeq>t&&(t=e.properties.explodeSeq)},this)},this),this.game.time.events.add(t*PiecSettings.staggerDestroyDelay+10,function(){this.fall(PiecSettings.fallUpwards),this.fallFrom(PiecSettings.fallUpwards)},this)}},this)},this)}else{if(i.length<=PiecSettings.minMatchSize)return void e.wiggle();var a=null,l=!1;PiecSettings.tapCombineRules.forEach(function(t){if(i.length>=t.amountMin&&i.length<=t.amountMax)for(var s=0;s<PiecSettings.tiles.length;s++)PiecSettings.tiles[s].id===t.generates.replace("%color%",e.properties.color)&&(a=s,l=!0)}),!0===l&&i.forEach(function(t){this.game.add.tween(t).to({x:e.x,y:e.y},PiecSettings.combineDelay,Phaser.Easing.Linear.None,!0)},this),this.game.time.events.add(!0===l?PiecSettings.combineDelay:0,function(){!0===l&&e.combine(this.game,this),this.updateMoveStats(i),this.floodFill(e.properties.y,e.properties.x,e.properties.tileType,a,l),this.fall(PiecSettings.fallUpwards),this.fallFrom(PiecSettings.fallUpwards)},this)}this.game.onMoveStart(this.game)},this)}}},{key:"staggerExplode",value:function(){this.game.time.events.add(1e3,function(){var e=[];this.staggerExplosions.forEach(function(t){var i,s;null!==t&&!0!==t.properties.indestructable&&(t.explode(this.game,this),s=PiecSettings.tiles[t.properties.tileType],(i=p.default[s.explode])&&e.push({color:"any",hMatches:PiecSettings.minMatchSize,original:t,tiles:y.getMatches(this.game.global.tiles,t,i),vMatches:PiecSettings.minMatchSize,explosion:i}))},this);var t=0;e.forEach(function(e){e.tiles.forEach(function(e){e.properties.explodeSeq>t&&(t=e.properties.explodeSeq)},this)},this),this.destroyMatchingTiles(e,!1),this.game.time.events.add(t*PiecSettings.staggerDestroyDelay,function(){this.fall(PiecSettings.fallUpwards),this.fallFrom(PiecSettings.fallUpwards)},this)},this)}},{key:"floodFill",value:function(e,t,i,s,o){if(e>=0&&e<this.properties.fieldSize&&t>=0&&t<this.properties.fieldSize&&null!==this.game.global.tiles[e][t]&&this.game.global.tiles[e][t].properties.tileType===i){var r=!1;PiecSettings.gridShape.forEach(function(i){i.x===this.game.global.tiles[e][t].properties.x&&i.y===this.game.global.tiles[e][t].properties.y&&(r=!0)},this),!1===r&&(s?this.game.global.tiles[e][t].swapImg(s):(!0===o&&(this.game.global.tiles[e][t].properties.surpressExplodeAnimation=!0),!0!==this.game.global.tiles[e][t].properties.indestructable&&(this.game.global.tiles[e][t].explode(this.game,this),this.game.global.tiles[e][t]=null)),this.floodFill(e+1,t,i,!1,o),this.floodFill(e-1,t,i,!1,o),this.floodFill(e,t+1,i,!1,o),this.floodFill(e,t-1,i,!1,o))}}},{key:"fall",value:function(e){!0===e?this.fallUp():this.fallDown()}},{key:"fallUp",value:function(){for(var e=0;e<this.properties.fieldSize;e++)for(var t=0;t<this.properties.fieldSize;t++)if(null!==this.game.global.tiles[e][t]){var i=this.holesAbove(e,t);if(i>0){if(-1!==this.game.global.freezeCols.indexOf(t))continue;this.game.global.tiles[e][t].fall(this.game,-1*i,this.properties.tileSize)}}}},{key:"fallDown",value:function(){for(var e=this.properties.fieldSize-1;e>=0;e--)for(var t=0;t<this.properties.fieldSize;t++)if(null!=this.game.global.tiles[e][t]){var i=this.holesBelow(e,t);if(i>0){if(-1!==this.game.global.freezeCols.indexOf(t))continue;this.game.global.tiles[e][t].fall(this.game,i,this.properties.tileSize)}}}},{key:"fallFrom",value:function(e){!1!==PiecSettings.tilesReplenish&&(!0===e?this.fallFromBottom():this.fallFromTop())}},{key:"fallFromTop",value:function(){for(var e=0;e<this.properties.fieldSize;e++)for(var t=this.holesBelow(-1,e),i=0;i<t;i++)if(null===this.game.global.tiles[i][e]){if(-1!==this.game.global.freezeCols.indexOf(e))continue;this.game.global.tiles[i][e]=new u.default(this.game,e,-(t-i),Math.floor(Math.random()*PiecSettings.tileTypes),this.properties.tileSize),this.game.global.tiles[i][e].fall(this.game,t,this.properties.tileSize),this.add(this.game.global.tiles[i][e])}}},{key:"fallFromBottom",value:function(){for(var e,t,i=0;i<this.properties.fieldSize;i++)for(var s=this.holesBelow(-1,i),o=0;o<s;o++)e=this.properties.fieldSize-o-1,t=this.properties.fieldSize+(s-o-1),-1===this.game.global.freezeCols.indexOf(i)&&(this.game.global.tiles[e][i]=new u.default(this.game,i,t,Math.floor(Math.random()*PiecSettings.tileTypes),this.properties.tileSize),this.game.global.tiles[e][i].fall(this.game,-1*(t-e),this.properties.tileSize),this.add(this.game.global.tiles[e][i]))}},{key:"holesBelow",value:function(e,t){for(var i=0,s=e+1;s<this.properties.fieldSize;s++)null===this.game.global.tiles[s][t]&&i++;return i}},{key:"holesAbove",value:function(e,t){for(var i=0,s=e+1;s>0;s--)null===this.game.global.tiles[s-1][t]&&i++;return i}},{key:"getHoles",value:function(){var e,t,i=0;for(e=0;e<this.properties.fieldSize;e++)for(t=0;t<this.properties.fieldSize;t++)null===this.game.global.tiles[e][t]&&i++;return i}},{key:"createRewardTiles",value:function(){if(!0!==this.game.global.isComplete)return 0===PiecSettings.rewardTiles.numberRewarded?void this.game.onGameComplete.dispatch():void this.game.time.events.add(1600,function(){this.game.global.isComplete=!0;for(var e,t,i=!0,s=0;s<PiecSettings.rewardTiles.numberRewarded;s++)this.game.time.events.add(PiecSettings.rewardTiles.rewardDelay*s,function(){for(t={explode:!0};void 0!==t.explode||!0===i;)i=!1,e=y.getRndTile(this.game.global.tiles),t=y.getTileType(e),PiecSettings.gridShape.forEach(function(t){t.x===e.properties.x&&t.y===e.properties.y&&(i=!0)});e.combine(this.game,this),e.swapImg(v.sample(PiecSettings.rewardTiles.possibleTiles)),this.batchExplode=this.batchExplode||[],this.batchExplode.push(e)},this);this.game.time.events.add(PiecSettings.rewardTiles.rewardDelay*(PiecSettings.rewardTiles.numberRewarded+1),function(){this.game.onCreatedRewardTiles.dispatch(),this.destroyRandomBatchExplodeItem()},this)},this)}},{key:"explodeRewardTiles",value:function(){var e=y.getAllUniqueGamePieces(this.game.global.tiles);e.length>0?(piec.unlockGame(),this.pickTile(v.sample(e),!1)):this.game.time.events.add(500,function(){this.game.onGameComplete.dispatch()},this)}}]),t}(Phaser.Group);i.default=b},{"../prefabs/explosions":3,"../prefabs/tile":6,"../utils/custom-tile-events":12,"../utils/tile-util":14,"../utils/util":15}],5:[function(e,t,i){"use strict";function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(i,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),l=e("../utils/custom-tile-events"),c=(s(l),e("../utils/util")),p=(s(c),function(e){function t(e,i,s,n,a){o(this,t);var l=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));l.settings={particles:[],frame:0,amplitude:6,distance:.1,distanceVarient:10,ghostingEffect:.225,originY:s,x1:i,y1:s,x2:n,y2:a},l.anchor.setTo(.5,.5);var c,p,h,u,d=n-i,g=a-s,f=Math.sqrt(d*d+g*g),y=i+f,m=180*Math.atan2(g,d)/Math.PI,v=u={x:i,y:s};do{c=l.settings.distance+l.settings.distanceVarient*Math.random(),p=v.x+c,h=v.y,u={x:p,y:h},l.settings.particles.push(u),v=u}while(u.x<y);return e.add.existing(l),l.angle=m,l.pivot.x=i,l.pivot.y=s,l.x=i,l.y=s,l}return n(t,e),a(t,[{key:"randomColorHSLA",value:function(e,t){return"hsla("+Math.round(e+Math.random()*(t-e))+",100%,50%,1)"}},{key:"moveParticle",value:function(e){var t=this.settings.particles[e],i=this.settings.particles[e+1],s=this.settings.particles[e-1],o=.1*(this.settings.originY-t.y),r=this.settings.amplitude/2-Math.random()*this.settings.amplitude;t.y+=0+o+r,t.x-=(t.x-s.x-(i.x-t.x))/2*.05;t.x+=2-4*Math.random()}},{key:"update",value:function(){this.clear(),this.fillStyle="rgba(0,0,0,"+this.settings.ghostingEffect+")",this.lineStyle(4,16777215,1);var e=(Math.floor(127+128*Math.random()),Math.floor(256*Math.random()),Math.floor(256*Math.random()),this.settings.particles[0]);this.moveTo(e.x,e.y);for(var t=1;t<this.settings.particles.length-1;t++)this.lineTo(this.settings.particles[t].x,this.settings.particles[t].y),this.moveParticle(t)}}]),t}(Phaser.Graphics));i.default=p},{"../utils/custom-tile-events":12,"../utils/util":15}],6:[function(e,t,i){"use strict";function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(i,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),l=e("../utils/custom-tile-events"),c=s(l),p=e("../utils/custom-bounce"),h=function(e){return e&&e.__esModule?e:{default:e}}(p),u=e("../utils/util"),d=s(u),g=function(e){function t(e,i,s,n,a){o(this,t);var l=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i*a+a/2,s*a+a/2,"tiles",n));return l.anchor.setTo(.5,.5),l.properties={x:i,y:s,tileSize:a,swipeMinDistance:30,tileType:n,color:PiecSettings.tiles[n].color},l.inputEnabled=!0,l.input.useHandCursor=!0,l.events.onInputDown.add(l.onDown,l),!0===PiecSettings.isSwipe&&l.events.onInputUp.add(l.onUp,l),l.resize(),l}return n(t,e),a(t,[{key:"resize",value:function(){var e=this.properties.tileSize/this._frame.width;this.scale.x=e,this.scale.y=e}},{key:"explode",value:function(e,t){t.batchExplode=t.batchExplode||[],d.remove(t.batchExplode,this);var i=!1,s=0,o=PiecSettings.tiles[this.properties.tileType],r=this.properties.explodeSeq;void 0!==this.properties.explodeSeq&&(r>0&&r--,s=PiecSettings.staggerDestroyDelay*r),e.time.events.add(s,function(){if(PiecSettings.gridShape.forEach(function(e){
e.x===this.properties.x&&e.y===this.properties.y&&(i=!0)},this),!1===i&&!0!==this.properties.surpressExplodeAnimation){if(o.explode)this.playAnimation(e,t,this.getAnimation(o.animation));else{var s=this.getAnimation(o.color+"DestroyTile");console.log(s),null===s&&(s=this.getAnimation("DestroyTile")),this.playAnimation(e,t,s,!0)}c.onTileDestroy(this,o)}!1===i&&this.destroy()},this)}},{key:"getAnimation",value:function(e){for(var t=0;t<PiecSettings.animations.length;t++)if(PiecSettings.animations[t].name===e)return PiecSettings.animations[t];return null}},{key:"swapImg",value:function(e){var t=PiecSettings.tiles[e];t.idleAnimation?(this.loadTexture(t.id,0),this.animations.add("idle"),this.animations.play("idle",30,!0)):this.frame=e,this.properties.tileType=e}},{key:"combine",value:function(e,t){if(PiecSettings.combineAnimation){var i=this.playAnimation(e,t,PiecSettings.combineAnimation);e.add.tween(i).to({angle:270},800,Phaser.Easing.Linear.None,!0)}}},{key:"playAnimation",value:function(e,t,i,s,o,r){if(i){var o=void 0!==o?o:t.x+this.x,r=void 0!==r?r:t.y+this.y,n=e.add.sprite(o,r,i.name);n.height=this.height*i.scale,n.width=this.width*i.scale,n.anchor.set(.5,.5),n.alpha=i.alpha||1,!0===s&&(n.angle=d.rndInt(360,0));var a=(n.animations.add(i.name),!0===i.looped);return n.animations.play(i.name,i.frameRate,a,!0),i.startFrame&&n.animations.currentAnim.setFrame(i.startFrame,!0),n}}},{key:"onDown",value:function(){if(!0===PiecSettings.isSwipe)return void(this.swipeCoord={x:this.game.input.activePointer.position.x,y:this.game.input.activePointer.position.y});this.parent.pickTile(this)}},{key:"onUp",value:function(){this.game.input.activePointer.position.x<this.swipeCoord.x-this.properties.swipeMinDistance?this.parent.swipeTile(this,"left"):this.game.input.activePointer.position.x>this.swipeCoord.x+this.properties.swipeMinDistance?this.parent.swipeTile(this,"right"):this.game.input.activePointer.position.y<this.swipeCoord.y-this.properties.swipeMinDistance?this.parent.swipeTile(this,"up"):this.game.input.activePointer.position.y>this.swipeCoord.y+this.properties.swipeMinDistance&&this.parent.swipeTile(this,"down")}},{key:"fall",value:function(e,t,i){var s=this.properties.x,o=this.properties.y;if(null!==s&&null!=o){this.properties.isFalling=!0,e.global.fallingTiles++;var r=e.add.tween(this);this.properties.x=null,this.properties.y=null;var n=(o+t)*i+i/2;this.properties.fallTo=o+t;var a=new h.default({strength:PiecSettings.TileBounceStrength});r.to({y:n},d.calcQuadTime(this.y-n)*PiecSettings.TileBounceStrength*PiecSettings.TileBounceScalar,function(e){return a.Bounce.Ease(e)},!0),r.onComplete.add(function(){if(!0===PiecSettings.tileSquash){var i=.9*this.scale.y,r=.95*this.scale.y,n=this.scale.y*this.height,a=r*this.height,l=this.y+n-a,p=e.add.tween(this.scale).to({x:this.scale.x,y:i},110,"Linear",!0,0),h=e.add.tween(this).to({y:l},110,"Linear",!0,0);p.yoyo(!0,0),h.yoyo(!0,0)}this.properties.isFalling=!1,this.properties.x=s,this.properties.y=o+t,!0===PiecSettings.isSwipe?(e.state.states.endcard.grid.removeDupes(this),e.time.events.add(10,function(){e.global.fallingTiles--,e.state.states.endcard.grid.matchAllTiles()},this)):(e.global.fallingTiles--,e.state.states.endcard.grid.onMoveComplete()),c.onTileLand(this)},this),e.global.tiles[o]&&e.global.tiles[o][s]&&(e.global.tiles[o+t][s]=e.global.tiles[o][s],e.global.tiles[o][s]=null)}}},{key:"moveTo",value:function(e,t,i,s,o){var r=e.add.tween(this);r.to({x:t,y:i},s,Phaser.Easing.Linear.None,!0),r.onComplete.add(o,this)}},{key:"wiggle",value:function(){var e=this.game.add.tween(this);this.bringToTop();e.to({angle:[-15,15,-15,15,-15,0]},500,Phaser.Easing.Linear.None,!0),e.onComplete.add(function(){piec.unlockGame()},this)}},{key:"jiggle",value:function(){var e=this.game.add.tween(this);this.bringToTop();e.to({angle:[-4,4,-4,4,-4,0]},500,Phaser.Easing.Linear.None,!0).loop(!0)}}]),t}(Phaser.Sprite);i.default=g},{"../utils/custom-bounce":10,"../utils/custom-tile-events":12,"../utils/util":15}],7:[function(e,t,i){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),a=function(e){function t(){return s(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return r(t,e),n(t,[{key:"preload",value:function(){}},{key:"init",value:function(){PiecSettings.assetsDir="dev"===PiecSettings.env?"assets/":"";var e=this.game;PiecSettings.pickInitialTile=new Phaser.Signal,e.onGameComplete=new Phaser.Signal,e.onCompleteLevel=new Phaser.Signal,e.onCreatedRewardTiles=new Phaser.Signal,"undefined"!=typeof piec&&(piec.lockGame=function(){e.global.locked=!0},piec.unlockGame=function(){e.global.locked=!1},piec.completeLevel=function(){e.onCompleteLevel.dispatch()},piec.destroyGame=function(){e.destroy()}),window.onresize=function(){var t=e.state.states[e.state.current];t.resize&&t.resize(),"undefined"!=typeof piec&&void 0!==piec.onResize&&piec.onResize()}}},{key:"create",value:function(){this.init(),this.game.input.maxPointers=1,this.initGlobalVariables(),this.disableScroll(),this.game.state.start("preloader"),this.game.onMoveStart=function(e){e.global.interactions++,PiecSettings&&PiecSettings.onMoveStart&&PiecSettings.onMoveStart(e.global.interactions)},this.game.onMoveComplete=function(e){PiecSettings&&PiecSettings.onMoveComplete&&PiecSettings.onMoveComplete(e.global.moveStats)}}},{key:"initGlobalVariables",value:function(){this.game.global={interactions:0,locked:!1,fallingTiles:0,isComplete:!1,freezeCols:[]}}},{key:"preventDefault",value:function(e){e=e||window.event,e.preventDefault&&e.preventDefault(),e.returnValue=!1}},{key:"disableScroll",value:function(){window.addEventListener&&window.addEventListener("DOMMouseScroll",this.preventDefault,!1),window.ontouchmove=this.preventDefault}},{key:"enableScroll",value:function(){window.removeEventListener&&window.removeEventListener("DOMMouseScroll",this.preventDefault,!1),window.ontouchmove=null}}]),t}(Phaser.State);i.default=a},{}],8:[function(e,t,i){"use strict";function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function o(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(i,"__esModule",{value:!0});var l=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),c=e("../prefabs/grid"),p=o(c),h=e("../prefabs/lightning"),u=(o(h),e("../utils/svg-util")),d=s(u),g=e("../utils/tile-util"),f=(s(g),function(e){function t(){return r(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return a(t,e),l(t,[{key:"create",value:function(){this.game.scale.scaleMode=Phaser.ScaleManager.USER_SCALE,this.game.scale.setUserScale(1/window.devicePixelRatio,1/window.devicePixelRatio,0,0),this.grid=new p.default(this.game,PiecSettings.grid),PiecSettings&&PiecSettings.resizeContainers&&PiecSettings.resizeContainers(),this.game.time.events.add(200,function(){this.game.add.tween(this.grid).to({alpha:1},300,Phaser.Easing.Linear.None,!0)},this),!0===PiecSettings.createBackGroundGrid&&this.createBackgroundSvg(),this.game.onCompleteLevel.add(this.onCompleteLevel,this),this.game.onGameComplete.add(this.onGameComplete,this)}},{key:"createBackgroundSvg",value:function(){var e=d.arrayToPolygonEdges(PiecSettings.fieldSize,PiecSettings.gridShape),t=d.getLines(e);document.getElementById("polygon").setAttribute("d",d.linesToSvgPolygon(t,PiecSettings.fieldSize))}},{key:"onCompleteLevel",value:function(){this.grid.createRewardTiles()}},{key:"onCreatedRewardTiles",value:function(){this.game.createdRewardTiles=!0}},{key:"onGameComplete",value:function(){PiecSettings&&PiecSettings.onGameComplete&&(this.game.time.events.add(500,function(){this.game.add.tween(this.grid).to({y:2e3},1e3,Phaser.Easing.Linear.None,!0)},this),PiecSettings.onGameComplete())}},{key:"resize",value:function(){this.grid.destroy(),this.grid=new p.default(this.game,PiecSettings.grid),this.game.time.events.add(200,function(){this.game.add.tween(this.grid).to({alpha:1},40,Phaser.Easing.Linear.None,!0)},this)}},{key:"render",value:function(){}}]),t}(Phaser.State));i.default=f},{"../prefabs/grid":4,"../prefabs/lightning":5,"../utils/svg-util":13,"../utils/tile-util":14}],9:[function(e,t,i){"use strict";function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(i,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),l=e("../const/cross-blast"),c=s(l),p=e("../utils/util"),h=(s(p),function(e){function t(){o(this,t);var e=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.asset=null,e}return n(t,e),a(t,[{key:"preload",value:function(){this.load.onLoadComplete.addOnce(this.onLoadComplete,this),this.loadResources()}},{key:"update",value:function(){}},{key:"loadResources",value:function(){this.atlasData={"cross-blast":c.default},this.game.load.spritesheet("tiles",PiecSettings.assetsDir+"icons.png",PiecSettings.iconsFrameWidth,PiecSettings.iconsFrameWidth),this.game.load.image("energy-stripe",PiecSettings.assetsDir+"energy-stripe.png"),PiecSettings.destroyAnimation&&this.game.load.spritesheet(PiecSettings.destroyAnimation.name,PiecSettings.assetsDir+PiecSettings.destroyAnimation.img,PiecSettings.destroyAnimation.frameWidth,PiecSettings.destroyAnimation.frameHeight,PiecSettings.destroyAnimation.frames),PiecSettings.combineAnimation&&this.game.load.spritesheet(PiecSettings.combineAnimation.name,PiecSettings.assetsDir+PiecSettings.combineAnimation.img,PiecSettings.combineAnimation.frameWidth,PiecSettings.combineAnimation.frameHeight,PiecSettings.combineAnimation.frames),PiecSettings.selfAnimation&&this.game.load.spritesheet(PiecSettings.selfAnimation.name,PiecSettings.assetsDir+PiecSettings.selfAnimation.img,PiecSettings.selfAnimation.frameWidth,PiecSettings.selfAnimation.frameHeight,PiecSettings.selfAnimation.frames),PiecSettings.enemyAnimation&&this.game.load.spritesheet(PiecSettings.enemyAnimation.name,PiecSettings.assetsDir+PiecSettings.enemyAnimation.img,PiecSettings.enemyAnimation.frameWidth,PiecSettings.enemyAnimation.frameHeight,PiecSettings.enemyAnimation.frames),PiecSettings.animations=PiecSettings.animations||[],PiecSettings.animations.forEach(function(e){!0===e.atlas?this.game.load.atlas(e.name,PiecSettings.assetsDir+e.img,null,this.atlasData[e.name]):this.game.load.spritesheet(e.name,PiecSettings.assetsDir+e.img,e.frameWidth,e.frameHeight,e.frames)},this)}},{key:"onLoadComplete",value:function(){this.game.state.start("endcard")}}]),t}(Phaser.State));i.default=h},{"../const/cross-blast":1,"../utils/util":15}],10:[function(e,t,i){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),r=e("../utils/custom-ease"),n=function(e){return e&&e.__esModule?e:{default:e}}(r),a=function(){function e(t){s(this,e),this.vars=t=t||{},this.SquashEase=null,t.squash&&(this.Squash=new n.default),this.Bounce=new n.default,this.update(t)}return o(e,[{key:"normalizeX",value:function(e){var t,i=e.length,s=1/e[i-2];for(t=2;t<i;t+=2)e[t]=(e[t]*s*1e3|0)/1e3;e[i-2]=1}},{key:"update",value:function(e){e=e||this.vars;var t,i,s,o,r,a,l,c=Math.min(.999,e.strength||.7),p=c,h=(e.squash||0)/100,u=h,d=1/.03,g=.2,f=1,y=.1,m=[0,0,.07,0,.1,1,.1,1],v=[0,0,0,0,.1,0,.1,0];for(r=0;r<200&&(g*=p*((p+1)/2),f*=c*c,a=y+g,s=y+.49*g,o=1-f,t=y+f/d,i=s+.8*(s-t),h&&(y+=h,t+=h,s+=h,i+=h,a+=h,l=h/u,v.push(y-h,0,y-h,l,y-h/2,l,y,l,y,0,y,0,y,-.6*l,y+(a-y)/6,0,a,0),m.push(y-h,1,y,1,y,1),h*=c*c),m.push(y,1,t,o,s,o,i,o,a,1,a,1),c*=.95,d=f/(a-i),y=a,!(o>.999));r++);if(e.endAtStart){if(s=-.1,m.unshift(s,1,s,1,-.07,0),u)for(h=2.5*u,s-=h,m.unshift(s,1,s,1,s,1),v.splice(0,6),v.unshift(s,0,s,0,s,1,s+h/2,1,s+h,1,s+h,0,s+h,0,s+h,-.6,s+h+.033,0),r=0;r<v.length;r+=2)v[r]-=s;for(r=0;r<m.length;r+=2)m[r]-=s,m[r+1]=1-m[r+1]}return h&&(this.normalizeX(v),v[2]="C"+v[2],this.Squash||(this.Squash=new n.default),this.Squash.setData("M"+v.join(","))),this.normalizeX(m),m[2]="C"+m[2],this.Bounce.setData("M"+m.join(","))}}]),e}();i.default=a},{"../utils/custom-ease":11}],11:[function(e,t,i){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),r=function(){function e(t,i,o){s(this,e),this.numbersExp=/(?:(-|-=|\+=)?\d*\.?\d*(?:e[\-+]?\d+)?)[0-9]/gi,this.svgPathExp=/[achlmqstvz]|(-?\d*\.?\d*(?:e[\-+]?\d+)?)[0-9]/gi,this.scientific=/[\+\-]?\d*\.?\d+e[\+\-]?\d+/gi,this.needsParsingExp=/[cLlsS]/g,this.bezierError="CustomEase only accepts Cubic Bezier data.",this.calcEnd=!0,this.setData(i,o)}return o(e,[{key:"Ease",value:function(e){var t=this.lookup[e*this.l|0]||this.lookup[this.l-1];return t.nx<e&&(t=t.n),t.y+(e-t.x)/t.cx*t.cy}},{key:"setData",value:function(e,t){e=e||"0,0,1,1";var i,s,o,r,n,a,l,c,p,h,u=e.match(this.numbersExp),d=1,g=[];if(t=t||{},h=t.precision||1,this.data=e,this.lookup=[],this.points=g,this.fast=h<=1,(this.needsParsingExp.test(e)||-1!==e.indexOf("M")&&-1===e.indexOf("C"))&&(u=this.pathDataToBezier(e)),4===(i=u.length))u.unshift(0,0),u.push(1,1),i=8;else if((i-2)%6)throw this.bezierError;for(0==+u[0]&&1==+u[i-2]||this.normalize(u,t.height,t.originY),this.rawBezier=u,r=2;r<i;r+=6)s={x:+u[r-2],y:+u[r-1]},o={x:+u[r+4],y:+u[r+5]},g.push(s,o),this.bezierToPoints(s.x,s.y,+u[r],+u[r+1],+u[r+2],+u[r+3],o.x,o.y,1/(2e5*h),g,g.length-1);for(i=g.length,r=0;r<i;r++)l=g[r],c=g[r-1]||l,l.x>c.x||c.y!==l.y&&c.x===l.x||l===c?(c.cx=l.x-c.x,c.cy=l.y-c.y,c.n=l,c.nx=l.x,this.fast&&r>1&&Math.abs(c.cy/c.cx-g[r-2].cy/g[r-2].cx)>2&&(this.fast=!1),c.cx<d&&(c.cx?d=c.cx:(c.cx=.001,r===i-1&&(c.x-=.001,d=Math.min(d,.001),this.fast=!1)))):(g.splice(r--,1),i--);if(i=1/d+1|0,this.l=i,n=1/i,a=0,l=g[0],this.fast){for(r=0;r<i;r++)p=r*n,l.nx<p&&(l=g[++a]),s=l.y+(p-l.x)/l.cx*l.cy,this.lookup[r]={x:p,cx:n,y:s,cy:0,nx:9},r&&(this.lookup[r-1].cy=s-this.lookup[r-1].y);this.lookup[i-1].cy=g[g.length-1].y-s}else{for(r=0;r<i;r++)l.nx<r*n&&(l=g[++a]),this.lookup[r]=l;a<g.length-1&&(this.lookup[r-1]=g[g.length-2])}return this.calcEnd=1!==g[g.length-1].y||0!==g[0].y,this}},{key:"bezierToPoints",value:function(e,t,i,s,o,r,n,a,l,c,p){var h,u=(e+i)/2,d=(t+s)/2,g=(i+o)/2,f=(s+r)/2,y=(o+n)/2,m=(r+a)/2,v=(u+g)/2,b=(d+f)/2,x=(g+y)/2,S=(f+m)/2,P=(v+x)/2,w=(b+S)/2,M=n-e,T=a-t,E=Math.abs((i-n)*T-(s-a)*M),k=Math.abs((o-n)*T-(r-a)*M);return c||(c=[{x:e,y:t},{x:n,y:a}],p=1),c.splice(p||c.length-1,0,{x:P,y:w}),(E+k)*(E+k)>l*(M*M+T*T)&&(h=c.length,this.bezierToPoints(e,t,u,d,v,b,P,w,l,c,p),this.bezierToPoints(P,w,x,S,y,m,n,a,l,c,p+1+(c.length-h))),c}}]),e}();i.default=r},{}],12:[function(e,t,i){"use strict";function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function o(e){return e&&e.__esModule?e:{default:e}}function r(e){}function n(e,t,i,s){return s&&!0===s.destroyAll?(h(e,t,i,s),t.properties.noEmit=!0,void(i.properties.noEmit=!0)):s&&!0===s.horizontal&&1===s.blastRadius?void u(e,t,i,s):s&&!0===s.horizontal&&!0===s.vertical?(t.properties.noEmit=!0,i.properties.noEmit=!0,void c(e,t.parent.x+t.x,t.parent.y+t.y,t.width,t.scale.x,!0,!0)):s&&!0===s.horizontal&&!0===s.vertical?(t.properties.noEmit=!0,i.properties.noEmit=!0,void c(e,t.parent.x+t.x,t.parent.y+t.y,t.width,t.scale.x,!0,!0)):s&&!0===s.colorMatch?void l(e,t,i,s):void 0}function a(e,t){if(null!==e&&null!==e.parent&&!0!==e.properties.noEmit)switch(t.explode){case"horizontal":case"vertical":c(e.game,e.parent.x+e.x,e.parent.y+e.y,e.width,e.scale.x,"vertical"===t.explode,"horizontal"===t.explode)}}function l(e,t,i,s){var o="any"===t.properties.color?t:i,r="any"!==t.properties.color?t:i,n=(PiecSettings.tiles[r.properties.tileType].color,m.getAllTilesByColor(e.global.tiles,r.properties.color)),a=o.getAnimation("master-energy-charge"),l=o.playAnimation(e,e.state.states.endcard.grid,a),c=[];n.forEach(function(t){c.push(new f.default(e,o.x+e.state.states.endcard.grid.x,o.y+e.state.states.endcard.grid.y,t.x+e.state.states.endcard.grid.x,t.y+e.state.states.endcard.grid.y))},this),e.time.events.add(s.destroyDelay,function(){l.destroy(),c.forEach(function(e){e.destroy()},this)},this)}function c(e,t,i,s,o,r,n){if((!1!==r||!1!==n)&&null!==e){var a=[];!0===n&&(a.push(p(e,t,i,s,o,"left")),a.push(p(e,t,i,s,o,"right"))),!0===r&&(a.push(p(e,t,i,s,o,"up")),a.push(p(e,t,i,s,o,"down")));var l=0,c=0;a.forEach(function(s){s.tweenTo.x&&(l=Math.abs(t-s.tweenTo.x)),s.tweenTo.y&&(l=Math.abs(i-s.tweenTo.y)),c=l/150*100,e.add.tween(s).to(s.tweenTo,c,Phaser.Easing.Linear.None,!0)},this)}}function p(e,t,i,s,o,r){if(null!==e){var n=0,a={},l=new Phaser.Sprite(e,0,0,"energy-stripe");switch(l.scale.x=.5*o,l.scale.y=.5*o,l.x=t,l.y=i,r){case"left":n=270,a={x:s*o*-1};break;case"right":n=90,a={x:e.world.bounds.width+s*o};break;case"up":n=0,a={y:l.height*o*-1};break;case"down":n=180,a={y:e.world.bounds.height+l.height*o}}return a.height=l.height,a.alpha=[.3,0],l.alpha=.3,l.height=.8*l.height,l.angle=n,l.tweenTo=a,l.anchor.setTo(.5,.5),e.add.existing(l),l}}function h(e,t,i,s){var o,r=t.x===i.x;o=!0===r?{y:Math.min(t.y,i.y)+.5*Math.abs(t.y-i.y)}:{x:Math.min(t.x,i.x)+.5*Math.abs(t.x-i.x)};var n=t.getAnimation("master-energy-charge"),a=t.getAnimation("halo"),l=e.add.tween(t).to(o,250,Phaser.Easing.Linear.None,!0);e.add.tween(i).to(o,250,Phaser.Easing.Linear.None,!0);l.onComplete.add(function(){var i=t.x+t.parent.x,s=t.y+t.parent.y,o=t.playAnimation(e,t.parent,n);e.time.events.add(1100,function(){var r=t.playAnimation(e,t.parent,a,!1,i,s);r.scale.x=0,r.scale.y=0;e.add.tween(r.scale).to({x:10,y:10},500,Phaser.Easing.Linear.None,!0),e.add.tween(r).to({alpha:0},500,Phaser.Easing.Quadratic.Out,!0);o.destroy()},this)},this)}function u(e,t,i,s){var o=[],r=[];for(n=-1;n<=1;n++)for(a=-1;a<=1;a++)e.global.tiles[t.properties.y+n]&&null!==e.global.tiles[t.properties.y+n][t.properties.x+a]&&(0===a&&o.push({x:e.global.tiles[t.properties.y+n][t.properties.x+a].x+t.parent.x,y:e.global.tiles[t.properties.y+n][t.properties.x+a].y+t.parent.y}),0===n&&r.push({x:e.global.tiles[t.properties.y+n][t.properties.x+a].x+t.parent.x,y:e.global.tiles[t.properties.y+n][t.properties.x+a].y+t.parent.y}));var n,a,l=m.getTileTypes(t.properties.color,"horizontal")[0],p=e.add.sprite(t.x+t.parent.x,t.y+t.parent.y,"tiles",PiecSettings.tiles.indexOf(l));p.scale.x=t.scale.x,p.scale.y=t.scale.y,p.anchor.set(.5,.5),p.alpha=.5;var h=m.getTileTypes(t.properties.color,"vertical")[0],u=t.width,d=i.scale.x,g=e.add.sprite(t.x+t.parent.x,t.y+t.parent.y,"tiles",PiecSettings.tiles.indexOf(h));g.scale.x=t.scale.x,g.scale.y=t.scale.y,g.anchor.set(.5,.5),g.alpha=0;var f=e.add.sprite(t.x+t.parent.x,t.y+t.parent.y,t.properties.color+"-motion-blur-h");f.scale.x=3*t.scale.x,f.scale.y=3*t.scale.y,f.anchor.set(.5,.5),f.alpha=0;var y=e.add.sprite(t.x+t.parent.x,t.y+t.parent.y,t.properties.color+"-motion-blur-v");y.scale.x=3*t.scale.x,y.scale.y=3*t.scale.y,y.anchor.set(.5,.5),y.alpha=0;var v=e.add.tween(p.scale).to({x:3*t.scale.x,y:3*t.scale.y},400,Phaser.Easing.Linear.None,!0);e.add.tween(p).to({alpha:1},400,Phaser.Easing.Quadratic.In,!0);for(v.onComplete.add(function(){var t=e.add.tween(p).to({alpha:0},125,Phaser.Easing.Quadratic.In,!0,0),i=(e.add.tween(p.scale).to({x:4},250,Phaser.Easing.Quadratic.In,!0,0),e.add.tween(f).to({alpha:1},125,Phaser.Easing.Quadratic.Out,!0,0)),s=e.add.tween(f).to({alpha:0},125,Phaser.Easing.Quadratic.In);i.chain(s);e.add.tween(f.scale).to({x:6},250,Phaser.Easing.Quadratic.In,!0,0);e.time.events.add(0,function(){o.forEach(function(t){c(e,t.x,t.y,u,d,!1,!0)},this)},this),t.onComplete.add(function(){g.alpha=.5;var t=e.add.tween(g.scale).to({x:3*g.scale.x,y:3*g.scale.y},500,Phaser.Easing.Linear.None,!0);e.add.tween(g).to({alpha:1},500,Phaser.Easing.Quadratic.In,!0);t.onComplete.add(function(){var t=(e.add.tween(g).to({alpha:0},250,Phaser.Easing.Quadratic.In,!0,0),e.add.tween(g.scale).to({y:4},250,Phaser.Easing.Quadratic.In,!0,0),e.add.tween(y).to({alpha:1},125,Phaser.Easing.Quadratic.In,!0,0)),i=e.add.tween(y).to({alpha:0},125,Phaser.Easing.Quadratic.In);t.chain(i);e.add.tween(y.scale).to({y:6},250,Phaser.Easing.Quadratic.In,!0,0);e.time.events.add(0,function(){r.forEach(function(t){c(e,t.x,t.y,u,d,!0,!1)},this)},this)},this)},this)},this),n=-1;n<=1;n++)for(a=-1;a<=1;a++)e.global.tiles[t.properties.y+n]&&null!==e.global.tiles[t.properties.y+n][t.properties.x+a]&&(e.global.tiles[t.properties.y+n][t.properties.x+a].alpha=0,e.global.tiles[t.properties.y+n][t.properties.x+a].properties.color="nevermatch");e.global.freezeCols=[t.properties.x-1,t.properties.x,t.properties.x+1]}Object.defineProperty(i,"__esModule",{value:!0}),i.onTileLand=r,i.onComboStart=n,i.onTileDestroy=a;var d=e("../prefabs/tile"),g=(o(d),e("../prefabs/lightning")),f=o(g),y=e("../utils/tile-util"),m=s(y),v=e("../utils/util");s(v)},{"../prefabs/lightning":5,"../prefabs/tile":6,"../utils/tile-util":14,"../utils/util":15}],13:[function(e,t,i){"use strict";function s(e,t){for(var i,s=[],o=0;o<e;o++)for(var r=0;r<e;r++)i=!1,t.forEach(function(e){e.x===o&&e.y===r&&(i=!0)},this),!1===i&&(s.push({startX:o,startY:r,endX:o+1,endY:r,type:"top"}),s.push({startX:o,startY:r,endX:o,endY:r+1,type:"left"}),s.push({startX:o+1,startY:r,endX:o+1,endY:r+1,type:"right"}),s.push({startX:o,startY:r+1,endX:o+1,endY:r+1,type:"bottom"}));var n=[],a=0;return s.forEach(function(e){a=0,s.forEach(function(t){e.startX===t.startX&&e.startY===t.startY&&e.endX===t.endX&&e.endY===t.endY&&a++},this),a<=1&&n.push(e)},this),n}function o(e){var t=this.getFirstUnconnected(e);t.connectedAtStart=!0;for(var i,s=[],o=0;null!==t;){for(i=[];null!==t&&o<1e3;)t=this.getConnected(t,e),null!==t&&(i.push(t.coords),t=t.item,t.isConnected=!0),o++;i.length>0&&s.push(i),t=this.getFirstUnconnected(e)}return s}function r(e){for(var t=0;t<e.length;t++)if(void 0===e[t].isConnected)return e[t];return null}function n(e,t){for(var i=0;i<t.length;i++)if(!0!==t[i].isConnected)if(!1!==e.connectedAtStart){if(e.endX===t[i].startX&&e.endY===t[i].startY)return t[i].connectedAtStart=!0,{item:t[i],coords:{type:t[i].type,x:t[i].startX,y:t[i].startY}};if(e.endX===t[i].endX&&e.endY===t[i].endY)return t[i].connectedAtStart=!1,{item:t[i],coords:{type:t[i].type,x:t[i].endX,y:t[i].endY}}}else{if(e.startX===t[i].startX&&e.startY===t[i].startY)return t[i].connectedAtStart=!0,{item:t[i],coords:{type:t[i].type,x:t[i].startX,y:t[i].startY}};if(e.startX===t[i].endX&&e.startY===t[i].endY)return t[i].connectedAtStart=!1,{item:t[i],coords:{type:t[i].type,x:t[i].endX,y:t[i].endY}}}return null}function a(e,t){switch(e.type){case"left":return{x:-.8,y:"top"===t.type?-.8:"bottom"===t.type?.8:0};case"right":return{x:.8,y:"top"===t.type?-.8:"bottom"===t.type?.8:0};case"top":return{x:"left"===t.type?-.8:"right"===t.type?.8:0,y:-.8};case"bottom":return{x:"left"===t.type?-.8:"right"===t.type?.8:0,y:.8}}}function l(e,t){var i,s,o,r,n="";return e.forEach(function(e){for(var a=0;a<e.length;a++)i=e[a].x/t*100,s=e[a].y/t*100,o=0===a?e[e.length-1]:e[a-1],r=this.getOffset(e[a],o),i+=r.x,s+=r.y,0===a&&(n+="M"+i+" "+s+" "),n+="L"+i+" "+s+" ";n+=" Z"},this),n}Object.defineProperty(i,"__esModule",{value:!0}),i.arrayToPolygonEdges=s,i.getLines=o,i.getFirstUnconnected=r,i.getConnected=n,i.getOffset=a,i.linesToSvgPolygon=l},{}],14:[function(e,t,i){"use strict";function s(e,t,i){var s=0,o=0;switch(i){case"up":o=-1;break;case"down":o=1;break;case"left":s=-1;break;case"right":s=1;break;case"ur":s=1,o=-1;break;case"ul":s=-1,o=-1;break;case"dr":s=1,o=1;break;case"dl":s=-1,o=1}return t.properties.x+s<0||t.properties.x+s>=e.length||t.properties.y+o<0||t.properties.y+o>=e.length?null:e[t.properties.y+o][t.properties.x+s]}function o(e,t,i){return i<0||i>=e.length||t<0||t>=e[0].length?null:e[i][t]}function r(e,t,i,s,o){var o=o||[],r=!1;if(PiecSettings.gridShape.forEach(function(e){e.x===t.properties.x&&e.y===t.properties.y&&(r=!0)},this),null===t||null===t.properties.x||null===t.properties.y||!0===r)return o;0===o.length&&o.push(t);var n=o[0],a=t.properties.color,l=n.properties.color;if(o.length>0&&!this.contains(o,t)&&a===l&&o.push(t),!0===i){var c=this.getAdjacent(e,t,"left"),p=this.getAdjacent(e,t,"right");c&&!this.contains(o,c)&&c.properties.color===l&&(o=this.getAllAdjacentMatches(e,c,i,s,o)),p&&!this.contains(o,p)&&p.properties.color===l&&(o=this.getAllAdjacentMatches(e,p,i,s,o))}if(!0===s){var h=this.getAdjacent(e,t,"down"),u=this.getAdjacent(e,t,"up");u&&!this.contains(o,u)&&u.properties.color===l&&(o=this.getAllAdjacentMatches(e,u,i,s,o)),h&&!this.contains(o,h)&&h.properties.color===l&&(o=this.getAllAdjacentMatches(e,h,i,s,o))}return o}function n(e,t,i){var s={h:this.getAllAdjacentMatches(e,t,!0,!1,[]),v:this.getAllAdjacentMatches(e,t,!1,!0,[])},o=[];return s.h.length>=i&&(o=o.concat(s.h)),s.v.length>=i&&(o=o.concat(s.v)),{original:t.properties,vMatches:s.v.length,hMatches:s.h.length,color:t.properties.color,tiles:T.uniq(o)}}function a(e,t){if(void 0===t)return!1;for(var i=0;i<e.length;i++)if(e[i].properties.x===t.properties.x&&e[i].properties.y===t.properties.y)return!0;return!1}function l(e,t){for(var i=[],s=0;s<e.length;s++)for(var o=0;o<e[s].length;o++)e[o][s]&&e[o][s].properties.color===t&&i.push(e[o][s]);return i}function c(e,t,i,s,o,r){for(var n=[],a=t.properties.explodeSeq||0,l=0;l<e.length;l++)for(var c=0;c<e[l].length;c++)null!==e[c][l]&&(!0===i&&l===t.properties.x&&(e[c][l].properties.explodeSeq=a+Math.abs(t.properties.y-c),n.push(e[c][l])),!0===s&&c===t.properties.y&&(e[c][l].properties.explodeSeq=a+Math.abs(t.properties.x-l),n.push(e[c][l])),!0===o&&c-t.properties.y==l-t.properties.x&&(e[c][l].properties.explodeSeq=a+Math.abs(t.properties.x-l),n.push(e[c][l])),!0===r&&c-t.properties.y==t.properties.x-l&&(e[c][l].properties.explodeSeq=a+Math.abs(t.properties.x-l),n.push(e[c][l])));return n}function p(e,t,i){for(var s=[],o=0;o<e.length;o++)for(var r=0;r<e[o].length;r++)e[r][o]&&e[r][o].properties.x<=t.properties.x+i&&e[r][o].properties.x>=t.properties.x-i&&e[r][o].properties.y<=t.properties.y+i&&e[r][o].properties.y>=t.properties.y-i&&(e[r][o].properties.explodeSeq=t.properties.explodeSeq||0,s.push(e[r][o]));return s}function h(){for(var e=[],t=0;t<PiecSettings.tileTypes;t++)e.push(PiecSettings.tiles[t].color);return e[Math.floor(Math.random()*e.length)]}function u(e,t,i,s){if(!0===i.colorMatch){if(!s&&PiecSettings.tiles[t.properties.tileType].colorMatch&&(s=PiecSettings.tiles[t.properties.tileType].colorMatch),!s)return[];var o=this.getAllMatches(e,s);return o.push(t),o}if(!0===i.horizontal||!0===i.vertical||!0===i.slopeUp||!0===i.slopeDown){var r=[],o=[];if(i.blastRadius>0){r=this.getWithBlastRadius(e,t,i.blastRadius),r.forEach(function(t){o=o.concat(this.getLinear(e,t,i.vertical,i.horizontal,i.slopeUp,i.slopeDown))},this);var n,a;return o.forEach(function(e){n=Math.abs(t.properties.x-e.properties.x),a=Math.abs(t.properties.y-e.properties.y),e.properties.explodeSeq=n>a?n:a},this),o=T.uniq(o)}return this.getLinear(e,t,i.vertical,i.horizontal,i.slopeUp,i.slopeDown)}return i.blastRadius>0?this.getWithBlastRadius(e,t,i.blastRadius):!0===i.destroyAll?this.getDestroyAll(e,t):void 0}function d(e,t){for(var i,s,o=[],r=0;r<e.length;r++)for(var n=0;n<e[r].length;n++)i=Math.abs(t.properties.x-e[n][r].properties.x),s=Math.abs(t.properties.y-e[n][r].properties.y),e[n][r].properties.explodeSeq=i>s?i:s,o.push(e[n][r]);return o}function g(e,t){if(!t)return[];var i=PiecSettings.tiles[t.properties.tileType],s=[];if(void 0!==i.explode){var o=w.default[i.explode];s=this.getMatches(e,t,o)}return s}function f(e,t,i){var s=[];return i=i||[],this.getTilesToDestroy(e,t).forEach(function(e){this.containsTile(i,e)||(i.push(e),s.push(e))},this),s.forEach(function(t){i=this.getAllTilesToDestroy(e,t,i)},this),i}function y(e,t){for(var i=0;i<e.length;i++)if(t&&e[i]&&e[i].properties.x===t.properties.x&&e[i].properties.y===t.properties.y)return!0;return!1}function m(e){return o(e,T.rndInt(PiecSettings.fieldSize-1,0),T.rndInt(PiecSettings.fieldSize-1,0))}function v(e){return PiecSettings.tiles[e.properties.tileType]}function b(e,t){var i=[];return PiecSettings.tiles.forEach(function(s){e&&s.color!==e||t&&s.explode!==t||i.push(s)},this),i}function x(e){for(var t,i,s=[],o=0;o<PiecSettings.fieldSize;o++)for(var r=0;r<PiecSettings.fieldSize;r++)t=this.getItemAt(e,o,r),i=this.getTileType(t),void 0!==i.explode&&s.push(t);return s}function S(e,t){for(var i,s=[],o=0;o<PiecSettings.fieldSize;o++)for(var r=0;r<PiecSettings.fieldSize;r++)null!==(i=this.getItemAt(e,o,r))&&(this.getTileType(i),i.properties.color===t&&s.push(i));return s}Object.defineProperty(i,"__esModule",{value:!0}),i.getAdjacent=s,i.getItemAt=o,i.getAllAdjacentMatches=r,i.getLineMatches=n,i.contains=a,i.getAllMatches=l,i.getLinear=c,i.getWithBlastRadius=p,i.getRandomColor=h,i.getMatches=u,i.getDestroyAll=d,i.getTilesToDestroy=g,i.getAllTilesToDestroy=f,i.containsTile=y,i.getRndTile=m,i.getTileType=v,i.getTileTypes=b,i.getAllUniqueGamePieces=x,i.getAllTilesByColor=S;var P=e("../prefabs/explosions"),w=function(e){return e&&e.__esModule?e:{default:e}}(P),M=e("../utils/util"),T=function(e){if(e&&e.__esModule)return e;var t={}
;if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(M)},{"../prefabs/explosions":3,"../utils/util":15}],15:[function(e,t,i){"use strict";function s(e,t){return t||(t=0),Math.floor(Math.random()*(e-t+1))+t}function o(e){return e[this.rndInt(e.length-1,0)]}function r(e){return e||(e=1),"rgba("+this.rndInt(256)+","+this.rndInt(256)+","+this.rndInt(256)+","+e+")"}function n(){return window.innerHeight>window.innerWidth}function a(e){return JSON.parse(JSON.stringify(e))}function l(e,t){var i=e.indexOf(t);i>-1&&e.splice(i,1)}function c(e){return-1===e.lastIndexOf(".")?e:e.substring(0,e.lastIndexOf("."))}function p(e){e.style.opacity=0;var t=+new Date;!function i(){e.style.opacity=+e.style.opacity+(new Date-t)/400,t=+new Date,+e.style.opacity<1&&(window.requestAnimationFrame&&requestAnimationFrame(i)||setTimeout(i,16))}()}function h(e){return 100*Math.sqrt(2*Math.abs(e)/g)}function u(e){var t={boolean:{},number:{},string:{}},i=[];return e.filter(function(e){var s=void 0===e?"undefined":d(e);return s in t?!t[s].hasOwnProperty(e)&&(t[s][e]=!0):!(i.indexOf(e)>=0)&&i.push(e)})}Object.defineProperty(i,"__esModule",{value:!0});var d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};i.rndInt=s,i.sample=o,i.rndRgba=r,i.isPortrait=n,i.clone=a,i.remove=l,i.removeExtension=c,i.fadeIn=p,i.calcQuadTime=h,i.uniq=u;var g=19.8},{}]},{},[2]);
